{% extends "learn_base.html" %}
{% block learn_content %}
    
    <div class="card p-4 mt-0 beige-background" style="border: none;">
        <h2 class="card-title mt-0">Lesson 1: Table Positions (6 players)</h2>
    
        <div class="lesson-content mt-0 mb-0">
            <h3 class="mt-0 mb-3">Why does position matter?</h3>
            <p>Pre-flop position is actually very important! The actions people take in Poker give information, so players acting earlier have less information about other players' hands.</p>
            <p>Therefore, they should play a smaller <b>range</b> of hands (play "tighter"). The later in position you are, the more hands you can play profitably.</p>
            <p class="text-muted mt-3"><i>Hover over different positions on the table image below to learn more about each position! Action starts at UTG.</i></p>
        </div>
        <!-- Position Image with Interactive Areas -->
        <div class="text-center mb-0 mt-0 my-4">
            <div class="poker-table-container">
                <img src="{{ url_for('static', filename='images/poker_pos.png') }}" 
                     alt="Poker Table Positions" 
                     class="img-fluid rounded poker-table-img" 
                     style="max-width: 600px;">
                
                <!-- Clickable/Hoverable Areas -->
                <div class="position-area early-position" data-position="early">
                    <!-- UTG Area -->
                </div>
                <div class="position-area middle-position" data-position="middle">
                    <!-- MP/HJ Area -->
                </div>
                <div class="position-area late-position" data-position="late">
                    <!-- CO/BTN Area -->
                </div>
                <div class="position-area deal-position" data-position="deal">
                    <!-- CO/BTN Area -->
                </div>
                <div class="position-area sb-position" data-position="sb">
                    <!-- SB Area -->
                </div>
                <div class="position-area bb-position" data-position="bb">
                    <!-- BB Area -->
                </div>
                
                <!-- Description Cards -->
                <div class="position-description-card" id="early-position-card">
                    <div class="card-pointer left-pointer"></div>
                    <h4 class="text-primary">Under The Gun (UTG)</h4>
                    <ul>
                        <li>First player to act pre-flop</li>
                        <li>Play (call/raise) a very tight range</li>
                        <li>After the flop, UTG acts after blinds but before everyone else</li>
                        <li>UTG raise is usually very strong</li>
                    </ul>
                </div>

                <div class="position-description-card" id="middle-position-card">
                    <div class="card-pointer left-pointer"></div>
                    <h4 class="text-success">Middle Position aka Hijack (MP/HJ)</h4>
                    <ul>
                        <li>Still pretty early, but a bit more flexibility than UTG</li>
                        <li>Can play a moderate, but still strong range</li>
                        <li>If UTG has called the big blind ("limped"), consider raising a strong hand to induce folds</li>
                        <li>Always consider players still to act</li>
                    </ul>
                </div>

                <div class="position-description-card" id="late-position-card">
                    <div class="card-pointer right-pointer"></div>
                    <h4 class="text-info">Cutoff (CO)</h4>
                    <ul>
                        <li>Good late position</li>
                        <li>Can raise a wider range if action has folded to you</li>
                        <li>But, still three players behind you pre-flop, and one post-flop</li>
                        <li>Be wary of the player on the Button</li>
                    </ul>
                </div>

                <div class="position-description-card" id="deal-position-card">
                    <div class="card-pointer right-pointer"></div>
                    <h4 class="text-info">Button / Dealer (D)</h4>
                    <ul>
                        <li>Most profitable position to play from - goes last post-flop</li>
                        <li>Can play wider range of hands</li>
                        <li>Opportunity to steal blinds by raising if action folds to you</li>
                        <li>More information about opponents' actions both now and post-flop</li>
                    </ul>
                </div>

                <div class="position-description-card" id="sb-position-card">
                    <div class="card-pointer right-pointer"></div>
                    <h4 class="text-warning">Small Blind (SB)</h4>
                    <ul>
                        <li>Already invested half a big blind</li>
                        <li>Play selectively and don't be afraid to fold the blind </li>
                        <li>Acts first post-flop</li>
                        <li>Often raise rather than call to avoid a flop if possible</li>
                    </ul>
                </div>

                <div class="position-description-card" id="bb-position-card">
                    <div class="card-pointer left-pointer"></div>
                    <h4 class="text-warning">Big Blind (BB)</h4>
                    <ul>
                        <li>Last to act pre-flop</li>
                        <li>Can call raises ("defend") with wider range due to cheaper price</li>
                        <li>If action has folded/limped to you, raise the widest range of hands</li>
                        <li>Get guaranteed flops with any hand if betting limps around</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <div class="lesson-navigation">
            <a href="/learn/0" class="btn btn-outline-secondary btn-lg lesson-nav-button">Back</a>
            <a href="/learn/2" class="lesson-nav-button">Next</a>
        </div>
    </div>

<style>
.position-explanations .card {
    transition: transform 0.2s;
}

.position-explanations .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.lesson-content ul {
    list-style-type: none;
    padding-left: 0;
}

.lesson-content ul li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.lesson-content ul li:last-child {
    border-bottom: none;
}

/* Poker Table Interactive Styles */
.poker-table-container {
    position: relative;
    display: inline-block;
    margin: 0 auto;
    max-width: 600px;
}

/* Add styles for the pointer/arrow connecting cards to positions */
.card-pointer {
    position: absolute;
    width: 15px;
    height: 15px;
    background-color: white;
    transform: rotate(45deg);
    border: 1px solid #ddd;
    z-index: 1;
}

.left-pointer {
    right: -7px;
    top: 20px;
    border-left: none;
    border-bottom: none;
}

.right-pointer {
    left: -7px;
    top: 20px;
    border-right: none;
    border-top: none;
}

.position-area {
    position: absolute;
    width: 120px;
    height: 120px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: background-color 0.2s;
}

.position-area:hover {
    /* Extremely subtle hover effect */
    background-color: rgba(0, 123, 255, 0.05);
}

/* Position areas on the table */
.early-position {
    top: 20%;
    left: 5%;
}

.middle-position {
    top: 5%;
    left: 40%;
}

.late-position {
    top: 14%;
    right: 6%;
}

.deal-position {
    bottom: 15%;
    right: 2%;
}

.sb-position {
    bottom: 1%;
    left: 47%;
}

.bb-position {
    bottom: 4%;
    left: 13%;
}

/* Description Cards */
.position-description-card {
    display: none;
    position: absolute;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    z-index: 20;
    width: 280px;
    text-align: left;
    transition: opacity 0.3s ease;
    pointer-events: none; /* This prevents the card from capturing mouse events */
    opacity: 0;
}

/* We'll position these in JavaScript dynamically */
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all position areas
    const positionAreas = document.querySelectorAll('.position-area');
    const tableContainer = document.querySelector('.poker-table-container');
    const tableImg = document.querySelector('.poker-table-img');
    
    // Add mouse events to each area
    positionAreas.forEach(area => {
        const position = area.getAttribute('data-position');
        const card = document.getElementById(`${position}-position-card`);
        
        // Show card on hover with smooth transition
        area.addEventListener('mouseenter', function(e) {
            // Position the card based on the area's position relative to the table
            positionCard(position, card, this, tableImg);
            
            // Show the card with fade-in effect
            card.style.display = 'block';
            setTimeout(() => {
                card.style.opacity = '1';
            }, 10);
        });
        
        area.addEventListener('mouseleave', function() {
            // Fade out effect
            card.style.opacity = '0';
            setTimeout(() => {
                card.style.display = 'none';
            }, 300); // Match transition duration
        });
    });
    
    // Function to dynamically position cards directly next to the table
    function positionCard(position, card, area, tableImg) {
        const areaRect = area.getBoundingClientRect();
        const tableRect = tableImg.getBoundingClientRect();
        const cardWidth = 280; // Width from CSS
        
        // Reset card positioning
        card.style.top = 'auto';
        card.style.bottom = 'auto';
        card.style.left = 'auto';
        card.style.right = 'auto';
        
        // Center the card vertically with the hovered area
        const cardTop = areaRect.top - tableRect.top + (areaRect.height / 2) - 75; // Approximate center
        card.style.top = cardTop + 'px';
        
        // Position cards directly beside the table image
        if (position === 'early' || position === 'middle' || position === 'bb') {
            // Position to the left of the table
            card.style.right = '100%';
            card.style.marginRight = '15px';
            
            // Adjust pointer position
            const pointerElement = card.querySelector('.card-pointer');
            pointerElement.className = 'card-pointer right-pointer';
            pointerElement.style.left = 'auto';
            pointerElement.style.right = '-7px';
        } else {
            // Position to the right of the table
            card.style.left = '100%';
            card.style.marginLeft = '15px';
            
            // Adjust pointer position
            const pointerElement = card.querySelector('.card-pointer');
            pointerElement.className = 'card-pointer left-pointer';
            pointerElement.style.right = 'auto';
            pointerElement.style.left = '-7px';
        }
    }
});
</script>
{% endblock %}