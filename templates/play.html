{% extends "layout.html" %}
{% block content %}
<div class="practice-container">
    <h1>{{ quiz.title }}</h1>
    <p class="lead">{{ quiz.description }}</p>

    <!-- Progress Bar -->
    <div class="progress-container mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="progress-text">Question <span id="current-question">1</span> of <span id="total-questions">1</span></span>
            <span class="progress-percentage"><span id="progress-percentage">0</span>%</span>
        </div>
        <div class="progress" style="height: 20px;">
            <div id="quiz-progress" class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" 
                 style="width: 0%" 
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100">
            </div>
        </div>
    </div>

    <div class="practice-area">
        <img src="{{ url_for('static', filename='images/' + quiz.image) }}"
            alt="{{ quiz.title }}" 
            class="img-fluid rounded" 
            style="max-width: 600px;">
    </div>
    
    <div class="action-buttons-container" style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
        <button class="btn btn-secondary action-button" style="min-width: 120px; font-size: 1.2em; padding: 15px;" onclick="submitDecision('Call', {{ quiz.buttons.call.amount }})">Call {{ quiz.buttons.call.amount }}</button>
        <button class="btn btn-primary action-button" style="min-width: 120px; font-size: 1.2em; padding: 15px;" onclick="submitDecision('Raise', {{ quiz.buttons.raise.amount }})">Raise {{ quiz.buttons.raise.amount }}</button>
        <button class="btn btn-danger action-button" style="min-width: 120px; font-size: 1.2em; padding: 15px;" onclick="submitDecision('AllIn', {{ quiz.buttons.allin.amount }})">All in {{ quiz.buttons.allin.amount }}</button>
        <button class="btn btn-dark action-button" style="min-width: 120px; font-size: 1.2em; padding: 15px;" onclick="submitDecision('Fold', {{ quiz.buttons.fold.amount }})">Fold</button>
    </div>

    <div id="feedback" class="mt-4" style="display: none;">
        <div class="alert" id="feedback-text"></div>
        <button id="next-button" class="btn btn-lg btn-primary" style="display: none;">Next Question</button>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Calculate progress
    const currentQuizId = {{ quiz.id }};
    fetch('/get-quiz-data')
        .then(response => response.json())
        .then(data => {
            const totalQuizzes = data.quiz_pages.length;
            const progress = (currentQuizId / totalQuizzes) * 100;
            
            // Update progress bar
            const progressBar = document.getElementById('quiz-progress');
            progressBar.style.width = `${progress}%`;
            progressBar.setAttribute('aria-valuenow', progress);
            
            // Update question numbers and percentage
            document.getElementById('current-question').textContent = currentQuizId;
            document.getElementById('total-questions').textContent = totalQuizzes;
            document.getElementById('progress-percentage').textContent = Math.round(progress);
        });
});

function submitDecision(decision, amount) {
    // Disable all buttons
    document.querySelectorAll('.action-button').forEach(btn => btn.disabled = true);
    
    fetch('/submit-decision', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            decision: decision,
            amount: amount,
            quiz_id: {{ quiz.id }}
        })
    })
    .then(response => response.json())
    .then(data => {
        // Show feedback
        const feedbackDiv = document.getElementById('feedback');
        const feedbackText = document.getElementById('feedback-text');
        const nextButton = document.getElementById('next-button');
        
        feedbackDiv.style.display = 'block';
        feedbackText.textContent = data.feedback;
        feedbackText.className = 'alert ' + (data.is_correct ? 'alert-success' : 'alert-danger');
        
        // Show next button or results link
        if (data.next_quiz) {
            nextButton.style.display = 'block';
            nextButton.onclick = () => window.location.href = `/play/${data.next_quiz}`;
        } else {
            nextButton.style.display = 'block';
            nextButton.textContent = 'See Results';
            nextButton.onclick = () => window.location.href = '/results';
        }
    });
}
</script>
{% endblock %}